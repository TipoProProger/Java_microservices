Интернет-магазин FIXME
======================

Общее описание
--------------
Приложение должно предоставлять возможность поставщикам праздничных услуг и товаров предлагать товар, покупателям просматривать каталог и формировать заказы, а менеджерам просматривать историю заказов и формировать счета на оплату поставщикам.

Роли в системе:

* Поставщик
* Покупатель
* Менеджер
* Администратор

Описание ролей
--------------

Покупатель
~~~~~~~~~~

Покупатели отделены от процесса заключения договоров с поставщиками. Для них наше приложение должно быть, как магазин, в котором можно прийти, сделать покупки и уйти.

Действия покупателя:

1. Просматривать каталог.
2. Выбрать товар в каталоге (добавить в корзину).
3. Просматривать корзину.
4. Изменить количество товара в корзине.
5. Удалить товар из корзины.
6. Отправить заказ на исполнение.
7. Просмотреть историю заказов.

Поставщик
~~~~~~~~~
Поставщикам не интересно, кто является покупателем их товаров и услуг, для них агентство — это покупатель.

Действия поставщика:

1. Просматривать свои предложения.
2. Добавить/удалить/изменить предложение.

Менеджер
~~~~~~~~
Менеджерам агентства нужен отдельный механизм для расчета чеков на оплату услуг поставщиков и просмотра истории заказов.

Действия менеджера:

1. Составить чек конкретному поставщику за месяц.
2. Просмотр истории заказов.

Администратор
~~~~~~~~~~~~~
Администратор обладает правом изменять предложения поставщиков и удалять их. В системе эта роль отвечает за модерацию предложений и общие контроль системы.

Действия администратора:

1. Просматривать каталог.
2. Просматривать предложения.
3. Изменять/удалять предложение.

Сценарии вариантов использования системы
----------------------------------------

Добавление предложения поставщиком
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Поставщик заходит в личный кабинет.
2. Поставщик выбирает добавить предложение.
3. Поставщик описывает предлагаемый им товар и заполняет карточку товара.
4. Поставщик указывает количество товара.
5. Поставщик сохраняет товар.

Добавление товара в корзину
~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Пользователь заходит в каталог товаров на сайте.
2. Открывает карточку товара из каталога.
3. Нажимает "купить". Товар добавляется в его корзину. 

Оформление заказа
~~~~~~~~~~~~~~~~~
1. Добавление как минимум одного товара в корзину.
2. Выбрать "Оформить заказ"
3. Заполнить предложенную форму и отправить её.
4. Заказ проверяется на возможность формирования.
5. Указанное количество выбранных товаров блокируется у поставщика.

Сформировать доходы поставщика от менеджера
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Менеджер заходит в личный кабинет.
2. Менеджер выбирает конкретного поставщика.
3. Менеджер нажимает "Сформировать счет" и указывает период (по умолчанию текущий месяц по дату формирования)
4. Формируется выборка всех заказов, которые были совершены у данного поставщика.

Микросервисы
------------
Микросервис продаж
~~~~~~~~~~~~~~~~~~
Предоставляет возможность покупателям просматривать каталог и делать заказы.

Функционал:

* `LoadProductRegistry`
+
Обновить каталог. Запрос на получение списка предложений отправляется на микросервис предложений. Полученный список сохраняется локально.
+
Данный метод доступен только микросервису и вызывается по таймеру. Требуется для синхронизации с микросервисом предложений.
+ 
**url:** load_product_registry
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** Список предложений `Offer`

* `ReadProductRegistry`
+
Прочитать каталог. Запрос на получение списке предложений микросервису продаж.
+ 
**url:** read_product_registry
+
**Метод:** `Get`
+
**Параметры:** Фильтр (в текущей версии только по цене) `ProductFilter`
+
**Возвращаемое значение:** Список предложений `Product`

* `CreateCartProduct`
+
Добавить товар в корзину.
+ 
**url:** cart_product
+
**Метод:** `Post`
+
**Параметры:** -
+
**Возвращаемое значение:** application/json с пустой записью товара `CartProduct`

* `UpdateCartProduct`
+
Изменить элемент в корзине.
+ 
**url:** cart_product
+
**Метод:** `Post`
+
**Параметры:** application/json с записью товара `CartProduct`
+
**Возвращаемое значение:** id записи

* `DeleteCartProduct`
+
Удалить элемент в корзине.
+ 
**url:** cart_product
+
**Метод:** `Post`
+
**Параметры:** id записи
+
**Возвращаемое значение:** bool статуса удаления

* `ReadCart`
+
Получить корзину покупателя.
+ 
**url:** cart_list
+
**Метод:** `Get`
+
**Параметры:** id покупателя
+
**Возвращаемое значение:** список товаров `CartProduct`

* `PostCart`
+
Сделать заказ. Запрос, чтобы сформировать заказ, проверить наличие составляющих заказа и отправить заказ микросервису истории заказов для добавления.
+ 
**url:** create_order
+
**Метод:** `Post`
+
**Параметры:** application/json со списком товаров `CartProduct`
+
**Возвращаемое значение:** id создвнного заказа Order или исключение с ошибкой.

* `Heartbeat`
+
Метод для проверки жизнеспособности микросервиса
Доступен только сервисам внутри системы. Пользователям данный метод недоступен.
+ 
**url:** stat
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** bool

Доступность методов микросервиса ролям
|===
|Метод|Покупатель|Поставщик|Менеджер|Администратор
|`LoadProductRegistry`|-|-|-|+
|`ReadProductRegistry`|+|-|-|+
|`CreateCartProduct`|+|-|-|+
|`UpdateCartProduct`|+|-|-|+
|`DeleteCartProduct`|+|-|-|+
|`ReadCart`|+|-|-|+
|`PostCart`|+|-|-|+
|`Heartbeat`|-|-|-|+
|===

Микросервис закупок
~~~~~~~~~~~~~~~~~~~
Предоставляет возможность поставщикам предлагать свои услуги и товары агентству.

Функционал:

* `List`
+
Получить список предложений с учетом фильтрации.
+ 
**url:** offer_list
+
**Метод:** `Get`
+
**Параметры:** Фильтр (пока с учетом только цены) `OfferFilter`
+
**Возвращаемое значение:** список товаров `Offer`

* `CreateOffer`
+
Добавить предложение.
+
**url:** create_offer
+
**Метод:** `Post`
+
**Параметры:** -
+
**Возвращаемое значение:** пустая запись `Offer`

* `UpdateOffer`
+
Изменить предложение.
+ 
**url:** update_offer
+
**Метод:** `Post`
+
**Параметры:** запись `Offer`
+
**Возвращаемое значение:** id записи

* `DeleteOffer`
+
Удалить предложение.
+ 
**url:** delete_offer
+
**Метод:** `Post`
+
**Параметры:** id записи предложения
+
**Возвращаемое значение:** bool статус удаления

* `ReadOffer`
+
Прочитать предложение.
+ 
**url:** read_offer
+
**Метод:** `Get`
+
**Параметры:** id записи `Offer`
+
**Возвращаемое значение:** запись `Offer`

* `GetSellers`
+
Получить список поставщиков.
+ 
**url:** sellers_list
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** список поставщиков `Offer`

* `Heartbeat`
+
Метод для проверки жизнеспособности микросервиса
Доступен только сервисам внутри системы. Пользователям данный метод недоступен.
+ 
**url:** stat
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** bool

Доступность методов микросервиса ролям
|===
|Метод|Покупатель|Поставщик|Менеджер|Администратор
|`List`|-|+|+|+
|`CreateOffer`|-|+|-|+
|`UpdateOffer`|-|+|-|+
|`DeleteOffer`|-|+|-|+
|`ReadOffer`|-|+|+|+
|`GetSellers`|-|-|+|+
|`Heartbeat`|-|-|-|+
|===

Микросервис истории заказов
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Предназначен для построения отчетов, счетов и хранения истории заказов.

Функционал:

* `CalcSellersIncome`
+
Получить счет на оплату товаров и услуг поставщика.
+
**url:** calc_income
+
**Метод:** `Get`
+
**Параметры:** Фильтр (id поставщика, дата начала перода, дата конца периода) `OrderFilter`
+
**Возвращаемое значение:** decimal с настройкой для хранения денежных значений.

* `List`
+
Получить список заказов.
+ 
**url:** order_list
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** список заказов `Order`

* `CreateOrder`
+
Записать заказ в историю.
+
**url:** create_order
+
**Метод:** `Post`
+
**Параметры:** список товаров корзины `CartProduct`
+
**Возвращаемое значение:** id созданного `Order`

* `UpdateOrder`
+
Обновить заказ.
+
**url:** update_order
+
**Метод:** `Post`
+
**Параметры:** запись `Order`
+
**Возвращаемое значение:** id записи

* `ReadOrderCustomer`
+
Получить информацию о заказе для покупателя.
+
**url:** read_order_customer
+
**Метод:** `Get`
+
**Параметры:** id записи `Order`
+
**Возвращаемое значение:** запись `Order`

* `ReadOrderSeller`
+
Получить информацию о заказе для поставщика.
+
**url:** read_order_seller
+
**Метод:** `Get`
+
**Параметры:** id записи `Order`
+
**Возвращаемое значение:** запись `Order`

* `ReadOrderManager`
+
Получить информацию о заказе.
+
**url:** read_order_manager
+
**Метод:** `Get`
+
**Параметры:** id записи `Order`
+
**Возвращаемое значение:** запись `Order`

* `Heartbeat`
+
Метод для проверки жизнеспособности микросервиса
Доступен только сервисам внутри системы. Пользователям данный метод недоступен.
+ 
**url:** stat
+
**Метод:** `Get`
+
**Параметры:** -
+
**Возвращаемое значение:** bool

Доступность методов микросервиса ролям
|===
|Метод|Покупатель|Поставщик|Менеджер|Администратор
|`CalcSellersIncome`|-|-|+|+
|`List`|-|-|+|+
|`CreateOrder`|+|-|-|+
|`UpdateOrder`|-|-|+|+
|`ReadOrderCustomer`|+|-|-|+
|`ReadOrderSeller`|-|+|-|+
|`ReadOrderManager`|-|-|+|+
|`Heartbeat`|-|-|-|+
|===

Микросервис меню сайта
~~~~~~~~~~~~~~~~~~~~~~

* `CheckHeartbeat`
+
Метод для проверки жизнеспособности микросервиса
Доступен только сервисам внутри системы. Пользователям данный метод недоступен.
+
Данный метод периодически запускается для обновления информации о сервисах внутри системы.

* `GetServiceHealtStats`
+ 
**url:** stat
+
**Метод:** `Get`
+
**Параметры:** url сервиса для проверки статуса
+
**Возвращаемое значение:** bool доступен ли сервис

Клиентами данных методов будут только другие микросервисы, поэтому ролевая настройка не требуется.

Логическая архитектура системы
------------------------------
image::out\ArchitectureLogicDiagram\ArchitectureLogicDiagram.png[]

Макеты интерфейсов
------------------

Интерфейс покупателя
~~~~~~~~~~~~~~~~~~~~
image::out\Makets\Maket-Интерфейс покупателя.jpg[]

Интерфейс поставщика
~~~~~~~~~~~~~~~~~~~~
image::out\Makets\Maket-Интерфейс поставщика.jpg[]

История заказов
~~~~~~~~~~~~~~~
image::out\Makets\Maket-История заказов.jpg[]

Карточка товара для покупки
~~~~~~~~~~~~~~~~~~~~~~~~~~~
image::out\Makets\Maket-Карточка товара для покупки.jpg[]

Карточка товара
~~~~~~~~~~~~~~~
image::out\Makets\Maket-Карточка товара.jpg[]

Корзина покупателя
~~~~~~~~~~~~~~~~~~
image::out\Makets\Maket-Корзина товара.jpg[]